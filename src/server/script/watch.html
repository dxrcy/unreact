<!-- *** This file is in DEVELOPMENT MODE! *** -->

<script>
    console.debug(
        "[debug] This document is in *development mode*\nDocument will reload automatically.",
    );

    /* Websocket stuff */
    let ws;
    connect();

    function connect() {
        if (ws) {
            ws.close();
        }

        console.debug("[debug] WS: Connecting...");
        ws = new WebSocket("ws://localhost:3001");

        ws.onopen = event => {
            console.debug("[debug] WS: Server open");
            cancel_reconnect();
        };

        ws.onclose = error => {
            console.debug("[debug] WS: Server closed");
            reconnect();
        };

        ws.onerror = error => {
            console.error("[debug] WS: Failed to connect!");
            reconnect();
        };

        ws.onmessage = event => {
            if (event.data === "reload") {
                console.debug("[debug] Reloading page...");
                location.reload();
            }
        };
    }

    let reconnect_interval;

    function reconnect() {
        cancel_reconnect();
        reconnect_interval = setInterval(connect, 1000);
    }

    function cancel_reconnect() {
        clearInterval(reconnect_interval);
    }
</script>
